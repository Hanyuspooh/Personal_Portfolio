---
categories:
- ""
- ""
date: "2020-09-16"
description: A skim at TFL sharing bike service in London before and after the pandemic.
draft: false
image: pic09.jpg
keywords: ""
slug: blog2
title: TFL bike sharing
---



<p><strong>Excess rentals in TfL bike sharing</strong></p>
<div id="first-we-load-the-dataset." class="section level3">
<h3>First, we load the dataset.</h3>
<pre class="r"><code>url &lt;- &quot;https://data.london.gov.uk/download/number-bicycle-hires/ac29363e-e0cb-47cc-a97a-e216d900a6b0/tfl-daily-cycle-hires.xlsx&quot;

# Download TFL data to temporary file
httr::GET(url, write_disk(bike.temp &lt;- tempfile(fileext = &quot;.xlsx&quot;)))</code></pre>
<pre><code>## Response [https://airdrive-secure.s3-eu-west-1.amazonaws.com/london/dataset/number-bicycle-hires/2020-08-26T09%3A19%3A21/tfl-daily-cycle-hires.xlsx?X-Amz-Algorithm=AWS4-HMAC-SHA256&amp;X-Amz-Credential=AKIAJJDIMAIVZJDICKHA%2F20200916%2Feu-west-1%2Fs3%2Faws4_request&amp;X-Amz-Date=20200916T063854Z&amp;X-Amz-Expires=300&amp;X-Amz-Signature=e7a9c186ccec426436bcae29f1875d96aec42e1e2674e4d92235dc19a7824c1c&amp;X-Amz-SignedHeaders=host]
##   Date: 2020-09-16 06:39
##   Status: 200
##   Content-Type: application/vnd.openxmlformats-officedocument.spreadsheetml.sheet
##   Size: 164 kB
## &lt;ON DISK&gt;  /var/folders/s8/dc1vl73j32b7qs__g4yxskzh0000gn/T//RtmphMtfiA/file1dda2debbf11.xlsx</code></pre>
<pre class="r"><code># Use read_excel to read it as dataframe
bike0 &lt;- read_excel(bike.temp,
                   sheet = &quot;Data&quot;,
                   range = cell_cols(&quot;A:B&quot;))

# change dates to get year, month, and week
bike &lt;- bike0 %&gt;% 
  clean_names() %&gt;% 
  rename (bikes_hired = number_of_bicycle_hires) %&gt;% 
  mutate (year = year(day),
          month = lubridate::month(day, label = TRUE),
          week = isoweek(day))</code></pre>
<p>We can easily create a facet grid that plots bikes hired by month and year.</p>
<p>The distribution of bike rentals for May and June 2020 appears to be more spread out when compared to previous years. This higher standard deviation in bike rentals in summar 2020 is as a result of the COVID-19 lockdown which changed the movement patterns of people in the city compared with previous years. People now use bikes rather than public transport for both essential travel and leisure.This explains some of the days in May and June that saw a high number of bikes being rented. However the lockdown has also caused bike rentals to be adversely affected on certain days with people having to work from home rather than office and not moving about as much.</p>
</div>
<div id="looking-at-monthly-changes-in-tfl-bike-rentals" class="section level2">
<h2>Looking at monthly changes in Tfl bike rentals:</h2>
<pre class="r"><code>#calculating actual and expected monthly averages for bike rentals
m1&lt;-bike %&gt;%
  filter(year %in% c(&quot;2015&quot;,&quot;2016&quot;,&quot;2017&quot;,&quot;2018&quot;,&quot;2019&quot;,&quot;2020&quot;)) %&gt;% 
  group_by(month,year) %&gt;% 
  summarise(actual=median(bikes_hired))</code></pre>
<pre><code>## `summarise()` regrouping output by &#39;month&#39; (override with `.groups` argument)</code></pre>
<pre class="r"><code>m2&lt;-m1 %&gt;%
  filter(year!=&quot;2020&quot;) %&gt;% 
  group_by(month) %&gt;% 
  summarise(expect=median(actual))</code></pre>
<pre><code>## `summarise()` ungrouping output (override with `.groups` argument)</code></pre>
<pre class="r"><code>monthly_average&lt;-left_join(m1,m2,&quot;month&quot;,&quot;year&quot;)


ggplot(data=monthly_average, aes(x=month))+
  #plotting two lines, blue for expected and black for actual rentals
  geom_line(aes(y=actual, group = 1), color= &quot;black&quot;,size=0.8) +
  geom_line(aes(y=expect, group = 1), color= &quot;blue&quot;) +
  facet_wrap(~year)+
  geom_ribbon(aes(x = month, ymin = actual, ymax = expect, fill= actual&gt; expect))+
  theme_pander()+
  scale_fill_manual(values=c(&quot;green&quot;, &quot;red&quot;), name=&quot;fill&quot;)+
  labs (
    title = &quot;Weekly changes in TfL bike rentals&quot;,
    subtitle= &quot;Change in monthly average shown in blue and calculated between 2015-2019&quot;,
    caption=&quot;Source: TfL, London Data Store&quot;,
    y= &quot;Bike rentals&quot;
  )+
  theme(
    axis.title.x=element_blank(),
    legend.position=&quot;none&quot;
  )</code></pre>
<p><img src="/blogs/blog2_files/figure-html/weekly%20changes%20in%20TFL%20bike%20rentals,%20fig8-1.png" width="1248" /></p>
<p>The blue line shows the mean value of a month during the five and a half years, implicating the expected rental, whereas the black line is the actual rental received. We can see a discrepancy in the spring 2020 due to the pandemic. However, sharing bike seems to come back after May 2020 to higher than expected, indicating people's urgent willingness of going out after the situation gets better.</p>
<p>We can also see that in the year 2018, summer has attracted more usage than spring compared to normal years. But in general, rentals reach the peak during summer and the lower limit during the winter for London.</p>
</div>
<div id="looking-at-weekly-changes-in-tfl-bike-rentals" class="section level2">
<h2>Looking at weekly changes in Tfl bike rentals:</h2>
<pre class="r"><code>#calculating expected weekly averages for bike rentals
weekly_avg &lt;- bike %&gt;% 
  filter(year %in% c(&quot;2015&quot;, &quot;2016&quot;, &quot;2017&quot;, &quot;2018&quot;, &quot;2019&quot;)) %&gt;% 
  group_by(year, week) %&gt;% 
  summarise(sum_rentals_period= sum(bikes_hired)) %&gt;% 
  group_by(week) %&gt;% 
  summarise(expected_rentals= median(sum_rentals_period))</code></pre>
<pre><code>## `summarise()` regrouping output by &#39;year&#39; (override with `.groups` argument)</code></pre>
<pre><code>## `summarise()` ungrouping output (override with `.groups` argument)</code></pre>
<pre class="r"><code>z = c(13,26,39,53)

#actual weekly rentals 
weekly_changes &lt;- bike %&gt;% 
  filter(year %in% c(&quot;2015&quot;, &quot;2016&quot;, &quot;2017&quot;, &quot;2018&quot;, &quot;2019&quot;, &quot;2020&quot;)) %&gt;% 
  group_by(year, week) %&gt;% 
  summarise(actual_rentals= sum(bikes_hired)) %&gt;% 
  left_join(weekly_avg, by=&quot;week&quot;) %&gt;% 
  mutate(diff_rentals= (actual_rentals- expected_rentals)/expected_rentals,
         sign= ifelse(diff_rentals&gt;0, &quot;pos&quot;, &quot;neg&quot;))</code></pre>
<pre><code>## `summarise()` regrouping output by &#39;year&#39; (override with `.groups` argument)</code></pre>
<pre class="r"><code>ggplot(weekly_changes)+
  #creating the grey tiles in plot background
  geom_rect(aes(xmin = 13, xmax = 26, ymin = -Inf, ymax = Inf),
                   fill = &quot;#f0f0f0&quot;, alpha = 0.002)+
  geom_rect(aes(xmin = 39, xmax = 53, ymin = -Inf, ymax = Inf),
                   fill = &quot;#f0f0f0&quot;, alpha = 0.002)+
  #adding a ribbon with color, green for positive diff and red for negative diff
  geom_ribbon(aes(x = week, ymin = 0, ymax = diff_rentals, fill =diff_rentals&lt;0, alpha=0.30))+
  geom_line(aes(x= week, y = diff_rentals, alpha=0.3))+
  #creating the rug
  geom_rug(data = . %&gt;%  filter(diff_rentals&gt; 0),
           mapping=aes(x=week, y= diff_rentals), color= &quot;#a1d99b&quot;, sides=&quot;b&quot;)+
  geom_rug(data = . %&gt;%  filter(diff_rentals&lt; 0),
          mapping=aes(x=week, y= diff_rentals), color= &quot;#a50f15&quot;, sides=&quot;b&quot;)+
  facet_wrap(~year)+
  theme_pander()+
  labs (
    title = &quot;Weekly changes in TfL bike rentals&quot;,
    subtitle= &quot;% change from weekly averages calculated between 2015-2019&quot;,
    caption=&quot;Source: TfL, London Data Store&quot;
  )+
  theme(
    axis.title.y=element_blank(),
    legend.position=&quot;none&quot;
  )+
  scale_y_continuous(labels = scales::percent)+
  #defining ticks on x-axis
  scale_x_continuous(breaks=z)+
  scale_fill_manual(values=c(&quot;#a1d99b&quot;, &quot;#bd0026&quot;), name=&quot;fill&quot;)</code></pre>
<p><img src="/blogs/blog2_files/figure-html/weekly%20changes%20in%20TFL%20bike%20rentals,%20fig9-1.png" width="1152" /></p>
<p>We used the median rather than the mean to calculate expected rentals since the median is less affected by the presence of outliers i.e days with a very high or very low number of bikes rented.</p>
<p>Similarly, it shows a rise in likelihood of sharing bike ridings in the starting of spring and summer, as well as a drop when it comes to winter and autumn, expecially when the New Year begins. The pandemic and lockdown during week 12-20 2020 witnessed a dramatic drop in TFL bike rentals.</p>
</div>
